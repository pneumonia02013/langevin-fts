ENABLE_TESTING()

# Generate files named "Test*.cpp"
FILE(GLOB TEST_LIST "Test*.cpp")
FOREACH(TEST_LIST ${TEST_LIST})
	GET_FILENAME_COMPONENT(TEST_NAME ${TEST_LIST} NAME_WE)
	ADD_EXECUTABLE(${TEST_NAME} ${TEST_LIST})
	TARGET_LINK_LIBRARIES(${TEST_NAME}
		factory
		$<IF:$<BOOL:${CUDAToolkit_FOUND}>,cuda,>
		$<IF:$<BOOL:${CUDAToolkit_FOUND}>,CUDA::cuda_driver,>
		$<IF:$<BOOL:${CUDAToolkit_FOUND}>,CUDA::cufft,>
		$<IF:$<BOOL:${BUILD_CPU_MKL_LIB}>,cpu-mkl,>
		$<IF:$<BOOL:${BUILD_CPU_MKL_LIB}>,-mkl,>
		$<IF:$<BOOL:${BUILD_CPU_FFTW_LIB}>,cpu-fftw,>
		$<IF:$<BOOL:${BUILD_CPU_FFTW_LIB}>,${FFTW_LIBRARY},>
		common
		)
	IF(${TEST_NAME} MATCHES "ParamParser")
		ADD_TEST(NAME ${TEST_NAME}
			COMMAND ${CMAKE_CURRENT_BINARY_DIR}/${TEST_NAME}
			WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR} 
			)
	ELSE()
		ADD_TEST(${TEST_NAME} ${CMAKE_CURRENT_BINARY_DIR}/${TEST_NAME})
	ENDIF()
ENDFOREACH()
